###########################################################################################################
#### Aethyr mixin for synchronizing aws models
###########################################################################################################
module Aethyr

  ########################################################################################################
  #### Mixins
  ########################################################################################################
  module Mixins

    ########################################################################################################
    #### methods added to controllers
    ########################################################################################################
    module MonomodelControllerHelper

      ######################################################################################################
      def self.included(base) 

        controller = base.controller_name
        model = controller
          
        base.class_eval <<-do_eval 

          def edit
            respond_to do |format|
              format.html {redirect_to(services_path)}
              format.js do
                render :update do |page|
                  page['agent-display'].replace_html :partial => 'edit'
                end
              end
            end
          end
            
          def find_#{model}
            @#{model} = #{model.camelize}.find_by_model(:first, :readonly => false)
            if @#{model}.nil?
              respond_to do |format|
                format.html {redirect_to(system_index_path)}
                format.js do
                  render :update do |page|
                    page.redirect_to system_index_path 
                  end
                end
              end
            end 
          end
          
        do_eval

      end           

    ########################################################################################################
    end #### MonomodelControllerHelper
    ########################################################################################################

  ########################################################################################################
  end #### Mixins
  ########################################################################################################

############################################################################################################
end #### Aethyr
############################################################################################################
    