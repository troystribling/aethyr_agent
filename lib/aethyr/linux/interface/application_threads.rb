############################################################################################################
module Aethyr

  ############################################################################################################
  module Linux
  
    ############################################################################################################
    module Interface
    
      ##########################################################################################################
      class ApplicationThreads
  
        ######################################################################################################
        #### class methods
        class << self
  
          ########################################################################################################
          def find(type = :all, options = {})
            if type.eql?(:first)
            else
              self.find_all
            end
          end

        ######################################################################################################
        protected
    
          ##########################################################################################################
          def find_all
            rows = `ps -eo pid,lwp,f,rtprio,ni,sz,vsz,rss,sess,wchan,stat,tty,time,pcpu,pmem,nlwp,psr,start,command`.split("\n")
            rows[0].lstrip!
            attr_names = rows.shift.split(/\s+/).collect{|a| a.gsub!(/%/, 'p'); a.downcase.to_sym}
            rows.collect do |r|
              row_start = r.slice!(0..107).chop
              started = r.slice!(0..8).chop
              started.gsub!(/^\s+/,'') if started =~ /^\s/
              attrs = row_start.split(/\s+/)
              row = {}
              attrs.each_index{|a| row.update(attr_names[a] => attrs[a])}
              row.merge(:started => started, :command => r)
            end            
          end
    
        ######################################################################################################
        end  
        
      ##########################################################################################################
      end
  
    ##########################################################################################################
    end

  ##########################################################################################################
  end
  
##########################################################################################################
end
